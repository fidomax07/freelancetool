@using Microsoft.AspNetCore.Mvc.Localization
@using FreelanceTool.Data;

@inject IViewLocalizer Localizer
@model PaginatedList<Applicant>

@{
	ViewData["Title"] = "Freelancer-Registration Administration";
}

<h2 class="extra-margin-vertical">@ViewData["Title"]</h2>
<p>
	Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras in turpis eu nunc hendrerit faucibus. Aliquam lacus nisl, vestibulum eget pharetra nec, molestie in libero. Integer quis erat sit amet risus hendrerit lobortis. Curabitur molestie mi feugiat, ullamcorper tortor sed, dictum mi. Nam aliquet tortor ex, gravida ornare justo ultrices condimentum. Interdum et malesuada fames ac ante ipsum primis in faucibus. In nec dui ante. Vivamus quis neque nibh. Maecenas at est elementum, pretium est id, porta dolor. Nulla convallis ante vel erat fringilla, eu ornare sapien euismod. Curabitur dapibus eu diam quis volutpat.

	Vestibulum ullamcorper nibh eu nisl volutpat lobortis. Morbi feugiat consectetur tortor, sed faucibus purus semper nec. Proin tincidunt tempus risus, eget sodales lorem vestibulum vitae. Etiam lobortis tortor sapien. Nam eget accumsan neque. Mauris id orci nisl. Vestibulum laoreet, sapien ut rhoncus bibendum, leo urna scelerisque leo, at volutpat dui tellus sed nisl.
</p>

@* Search box *@
<form asp-action="Index" method="get" id="applicant-search-form">
	<div class="form-group applicant-search-container">
		<div class="row">
			<div class="col-md-4 col-md-offset-3 col-sm-6 col-sm-offset-2 col-xs-8">
				<input type="number" class="form-control" name="ApplicantId"
					   value="@ViewData["CurrentApplicantId"]"
					   placeholder="Record-ID in the database"
					   data-val-required-cond="Database Record-ID is required!" />
				<span class="text-danger" id="applicant-id-error"></span>
			</div>
			<div class="col-md-2 col-sm-2 col-xs-4">
				<input type="submit" value="Search" class="btn btn-default btn-group-justified" />
			</div>
		</div>
	</div>
</form>

@* Custom message *@
@if (ViewBag.Message != null)
{
	<div class="row">
		<div class="col-md-6 col-md-offset-6">
			<div class="alert alert-success alert-dismissible" role="alert">
				<button type="button" class="close" data-dismiss="alert" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				@Localizer[$"{ViewBag.Message}"]
			</div>
		</div>
	</div>
}

<h3 class="extra-margin-vertical">List of registrations</h3>
<table class="table">
	<thead>
	<tr>
		<th>
			@*@Html.DisplayNameFor(model => model.CreatedAt)*@
			Date
		</th>
		<th>
			LastName
		</th>
		<th>
			FirstName
		</th>
		<th>
			Email
		</th>
		<th>Details</th>
	</tr>
	</thead>
	<tbody>
	@foreach (var item in Model)
	{
		<tr>
			<td>
				@Html.DisplayFor(modelItem => item.CreatedAt)
			</td>
			<td>
				@Html.DisplayFor(modelItem => item.LastName)
			</td>
			<td>
				@Html.DisplayFor(modelItem => item.FirstName)
			</td>
			<td>
				@Html.DisplayFor(modelItem => item.Email)
			</td>
			<td>
				<a asp-action="Details" asp-route-id="@item.Id">Show Details</a>
			</td>
		</tr>
	}
	</tbody>
</table>

@if (Model.HasPreviousPage || Model.HasNextPage)
{
	var prevDisabled = !Model.HasPreviousPage ? "disabled" : "";
	var nextDisabled = !Model.HasNextPage ? "disabled" : "";
	<div class="row">
		<div class="col-md-2 col-md-offset-4">
			<a asp-action="Index" asp-route-page="@(Model.PageIndex - 1)"
			   class="btn btn-default btn-block @prevDisabled">Previous
			</a>
		</div>
		<div class="col-md-2">
			<a asp-action="Index" asp-route-page="@(Model.PageIndex + 1)"
			   class="btn btn-default btn-block @nextDisabled">Next
			</a>
		</div>
	</div>
}

@section Scripts {
	<script>
		$(function () {

			// Client side validate the applicant-id to search for.
			(function () {
				var applicantSearchForm = $("form#applicant-search-form");
				var applicantIdInput = $("input[name='ApplicantId']").first();
				applicantSearchForm.on("submit", function (event) {
					event.preventDefault();

					if (isFieldEmpty(applicantIdInput)) {
						updateErrorMessage(
							applicantIdInput, "#applicant-id-error");
						scrollToError("#applicant-search-form");

						return;
					}

					applicantSearchForm.off("submit").submit();
				});
			}());

		});
	</script>
}
